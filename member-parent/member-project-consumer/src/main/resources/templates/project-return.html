<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
  <title>Return Setting
  </title>
<link rel="stylesheet" th:href="@{/bootstrap/css/bootstrap.min.css}"
	href="bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" th:href="@{/css/font-awesome.min.css}"
	href="css/font-awesome.min.css">
<link rel="stylesheet" th:href="@{/css/theme.css}" href="css/theme.css">
<style>
#footer {
	padding: 15px 0;
	background: #fff;
	border-top: 1px solid #ddd;
	text-align: center;
}

#topcontrol {
	color: #fff;
	z-index: 99;
	width: 30px;
	height: 30px;
	font-size: 20px;
	background: #222;
	position: relative;
	right: 14px !important;
	bottom: 11px !important;
	border-radius: 3px !important;
}

#topcontrol:after {
	/*top: -2px;*/
	left: 8.5px;
	content: "\f106";
	position: absolute;
	text-align: center;
	font-family: FontAwesome;
}

#topcontrol:hover {
	color: #fff;
	background: #18ba9b;
	-webkit-transition: all 0.3s ease-in-out;
	-moz-transition: all 0.3s ease-in-out;
	-o-transition: all 0.3s ease-in-out;
	transition: all 0.3s ease-in-out;
}

.label-type, .label-status, .label-order {
	background-color: #fff;
	color: #f60;
	padding: 5px;
	border: 1px #f60 solid;
}

#typeList  :not (:first-child ) {
	margin-top: 20px;
}

.label-txt {
	margin: 10px 10px;
	border: 1px solid #ddd;
	padding: 4px;
	font-size: 14px;
}

.panel {
	border-radius: 0;
}

.progress-bar-default {
	background-color: #ddd;
}
</style>
</head>
<body>
	<div class="navbar-wrapper">
		<div class="container">
			<nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
				<div class="container">
					<div class="navbar-header">
						<a class="navbar-brand" href="/" style="font-size: 32px;">MyFunding</a>
					</div>
					<div id="navbar" class="navbar-collapse collapse"
						style="float: right;">
						<ul class="nav navbar-nav">
							<li class="dropdown"><a href="#" class="dropdown-toggle"
								data-toggle="dropdown"><i class="glyphicon glyphicon-user"></i>
									[[${session.loginMember.username}]]<span class="caret"></span></a>
								<ul class="dropdown-menu" role="menu">
<!--									<li><a href="member.html"><i-->
<!--											class="glyphicon glyphicon-scale"></i> Member center</a></li>-->
<!--									<li><a href="#"><i class="glyphicon glyphicon-comment"></i>-->
<!--											Message</a></li>-->
									<li><a th:href="@{/auth/member/to/center/page}">Member center</a></li>
									<li><a th:href="@{/auth/member/to/center/page}">Message <span class="badge badge-success">42</span></a></li>
									<li class="divider"></li>
									<li><a th:href="@{/auth/member/logout}"><i
											class="glyphicon glyphicon-off"></i> Log out</a></li>
								</ul></li>
						</ul>
					</div>
				</div>
			</nav>
		</div>
	</div>

	<div class="container theme-showcase" role="main">

		<div class="container">
			<div class="row clearfix">
				<div class="col-md-12 column">
					<nav class="navbar navbar-default" role="navigation">
						<div class="collapse navbar-collapse"
							id="bs-example-navbar-collapse-1">
							<ul class="nav navbar-nav">
								<li><a rel="nofollow" href="index.html"><i
										class="glyphicon glyphicon-home"></i> Main</a></li>
								<li><a rel="nofollow" href="projects.html"><i
										class="glyphicon glyphicon-th-large"></i> Overview</a></li>
								<li class="active"><a rel="nofollow" href="javascript:;"><i
										class="glyphicon glyphicon-edit"></i> Rise funds</a></li>
								<li><a rel="nofollow" href="minecrowdfunding.html"><i
										class="glyphicon glyphicon-user"></i> My projects</a></li>
							</ul>
						</div>
					</nav>
				</div>
			</div>
		</div>

		<div class="container">
			<div class="row clearfix">
				<div class="col-md-12 column">
					<div class="panel panel-default">
						<div class="panel-heading" style="text-align: center;">
							<div class="container-fluid">
								<div class="row clearfix">
									<div class="col-md-3 column">
										<div class="progress"
											style="height: 50px; border-radius: 0; position: absolute; width: 75%; right: 49px;">
											<div class="progress-bar progress-bar-default"
												role="progressbar" aria-valuenow="60" aria-valuemin="0"
												aria-valuemax="100" style="width: 100%; height: 50px;">
												<div style="font-size: 16px; margin-top: 15px;">1.
													Personal info</div>
											</div>
										</div>
										<div
											style="right: 0; border: 10px solid #ddd; border-left-color: #88b7d5; border-width: 25px; position: absolute; border-left-color: rgba(221, 221, 221, 1); border-top-color: rgba(221, 221, 221, 0); border-bottom-color: rgba(221, 221, 221, 0); border-right-color: rgba(221, 221, 221, 0);">
										</div>
									</div>
									<div class="col-md-3 column">
										<div class="progress"
											style="height: 50px; border-radius: 0; position: absolute; width: 75%; right: 49px;">
											<div class="progress-bar progress-bar-success"
												role="progressbar" aria-valuenow="60" aria-valuemin="0"
												aria-valuemax="100" style="width: 100%; height: 50px;">
												<div style="font-size: 16px; margin-top: 15px;">2.
													Settings</div>
											</div>
										</div>
										<div
											style="right: 0; border: 10px solid #ddd; border-left-color: #88b7d5; border-width: 25px; position: absolute; border-left-color: rgba(92, 184, 92, 1); border-top-color: rgba(92, 184, 92, 0); border-bottom-color: rgba(92, 184, 92, 0); border-right-color: rgba(92, 184, 92, 0);">
										</div>
									</div>
									<div class="col-md-3 column">
										<div class="progress"
											style="height: 50px; border-radius: 0; position: absolute; width: 75%; right: 49px;">
											<div class="progress-bar progress-bar-default"
												role="progressbar" aria-valuenow="60" aria-valuemin="0"
												aria-valuemax="100" style="width: 100%; height: 50px;">
												<div style="font-size: 16px; margin-top: 15px;">3.
													Confirm</div>
											</div>
										</div>
										<div
											style="right: 0; border: 10px solid #ddd; border-left-color: #88b7d5; border-width: 25px; position: absolute; border-left-color: rgba(221, 221, 221, 1); border-top-color: rgba(221, 221, 221, 0); border-bottom-color: rgba(221, 221, 221, 0); border-right-color: rgba(221, 221, 221, 0);">
										</div>
									</div>
									<div class="col-md-3 column">
										<div class="progress" style="height: 50px; border-radius: 0;">
											<div class="progress-bar progress-bar-default"
												role="progressbar" aria-valuenow="60" aria-valuemin="0"
												aria-valuemax="100" style="width: 100%; height: 50px;">
												<div style="font-size: 16px; margin-top: 15px;">4. Finish</div>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-body">

							<div class="container-fluid">
								<div class="row clearfix">
									<div class="col-md-12 column">
										<blockquote
											style="border-left: 5px solid #f60; color: #f60; padding: 0 0 0 20px;">
											<b> Setting </b>
										</blockquote>
									</div>
									<div class="col-md-12 column">
										<table class="table table-bordered"
											style="text-align: center;">
											<thead>
												<tr style="background-color: #ddd;">
													<td>ID</td>
													<td>Payment amount</td>
													<td>Available number</td>
													<td>Limit</td>
													<td>Content</td>
													<td>Time</td>
													<td>Ship</td>
													<td>Operations</td>
												</tr>
											</thead>
											<tbody id="returnTableBody">
											</tbody>
										</table>
										<button id="addReturnBtn" type="button" class="btn btn-primary btn-lg">
											<i class="glyphicon glyphicon-plus"></i> Add setting
										</button>
										<div class="returnFormDiv"
											style="border: 10px solid #f60; border-bottom-color: #eceeef; border-width: 10px; width: 20px; margin-left: 20px; border-left-color: rgba(221, 221, 221, 0); border-top-color: rgba(221, 221, 221, 0); border-right-color: rgba(221, 221, 221, 0);"></div>
										<div class="panel panel-default returnFormDiv"
											style="border-style: dashed; background-color: #eceeef">
											<div class="panel-body">

												<div class="col-md-12 column">
													<form class="form-horizontal">
														<div class="form-group">
															<label for="inputEmail3" class="col-sm-2 control-label">Type</label>
															<div class="col-sm-10">
																<label class="radio-inline"> <input type="radio"
																	name="type" id="inlineRadio1"
																	value="0"> In-kind returns
																</label> <label class="radio-inline"> <input
																	type="radio" name="type"
																	id="inlineRadio2" value="1"> Virtual Item Returns
																</label>
															</div>
														</div>
														<div class="form-group">
															<label class="col-sm-2 control-label">Amount($)</label>
															<div class="col-sm-10">
																<input type="text" name="supportmoney" value="10" class="form-control"
																	style="width: 100px;">
															</div>
														</div>
														<div class="form-group">
															<label class="col-sm-2 control-label">Content</label>
															<div class="col-sm-10">
																<textarea class="form-control" name="content" rows="5"
																	placeholder="No more than 200 words"></textarea>
															</div>
														</div>
														<div class="form-group">
															<label class="col-sm-2 control-label">Images</label>
															<div class="col-sm-10">
																<input type="file" name="returnPicture" style="display: none;" />
																<button type="button" id="uploadBtn"
																	class="btn btn-primary btn-lg active">Upload</button>
																<label class="control-label">Format:jpg jpeg png gif</label>
																<br/>
																<img style="display: none" />
															</div>
														</div>
														<div class="form-group">
															<label class="col-sm-2 control-label">Return Amount</label>
															<div class="col-sm-10">
																<input type="text" name="count" value="5" class="form-control"
																	style="width: 100px; display: inline"> <label
																	class="control-label">'0' means No limit</label>
															</div>
														</div>
														<div class="form-group">
															<label for="inputEmail3" class="col-sm-2 control-label">Limits</label>
															<div class="col-sm-10">
																<label class="radio-inline"> <input type="radio"
																	name="signalpurchase" id="inlineRadio1"
																	value="0"> No limits
																</label> <label class="radio-inline"> <input
																	type="radio" name="signalpurchase"
																	id="inlineRadio2" value="1"> limits
																</label> <input type="text" name="purchase" value="8" class="form-control"
																	style="width: 100px; display: inline"> <label
																	class="radio-inline">No more than return amount </label>
															</div>
														</div>
														<div class="form-group">
															<label class="col-sm-2 control-label">Ship($)</label>
															<div class="col-sm-10">
																<input type="text" name="freight" value="0" class="form-control"
																	style="width: 100px; display: inline">
																<label class="control-label">'0' means free ship</label>
															</div>
														</div>
														<div class="form-group">
															<label for="inputEmail3" class="col-sm-2 control-label">Receipt</label>
															<div class="col-sm-10">
																<label class="radio-inline"> <input type="radio"
																	name="invoice" id="inlineRadio1"
																	value="0"> No receipt
																</label> <label class="radio-inline"> <input
																	type="radio" name="invoice"
																	id="inlineRadio2" value="1">
																	receipt
																</label>
															</div>
														</div>
														<div class="form-group">
															<label for="inputEmail3" class="col-sm-2 control-label">Return time</label>
															<div class="col-sm-10">
																<label class="radio-inline"> After project finish </label> <input
																	type="text" name="returndate" value="15" class="form-control"
																	style="width: 100px; display: inline"> <label
																	class="radio-inline">days</label>
															</div>
														</div>
														<div class="form-group">
															<label for="inputEmail3" class="col-sm-2 control-label"></label>
															<div class="col-sm-10">
																<button type="button" class="btn btn-primary" id="okBtn">confirm</button>
																<button type="button" class="btn btn-default">Cancel</button>
															</div>
														</div>

													</form>
												</div>

											</div>
										</div>
									</div>

									<div class="container">
										<div class="row clearfix">
											<div class="col-md-12 column">
<!--												<blockquote>-->
<!--													<p>-->
<!--														<i class="glyphicon glyphicon-info-sign"-->
<!--															style="color: #2a6496;"></i> 提示-->
<!--													</p>-->
<!--													<small>3个以上的回报：多些选择能提高项目的支持率。几十、几百、上千元的支持：3个不同档次的回报，能让你的项目更快成功。回报最好是项目的衍生品：<br>与项目内容有关的回报更能吸引到大家的支持。-->
<!--													</small>-->
<!--												</blockquote>-->
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel-footer" style="text-align: center;">
							<button type="button" class="btn  btn-default btn-lg"
								onclick="window.location.href='http://www.myfunding.com/project/launch/project/page'">Last</button>
							<a th:href="@{/project/create/confirm/page}" class="btn btn-warning btn-lg">next</a>
							<a class="btn"> View </a>
						</div>
					</div>
				</div>
			</div>
		</div>


		<div class="container" style="margin-top: 20px;">
			<div class="row clearfix">
				<div class="col-md-12 column">
					<div id="footer">
						<div class="footerNav">
							<a rel="nofollow" href="http://www.myFunding.com">About us</a> | <a
								rel="nofollow" href="http://www.myFunding.com">Service</a> | <a
								rel="nofollow" href="http://www.myFunding.com">Statement</a> | <a
								rel="nofollow" href="http://www.myFunding.com">Map</a> | <a
								rel="nofollow" href="http://www.myFunding.com">Contact us</a>
						</div>
						<div class="copyRight">Copyright@2020-2020myFunding.com
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>
	<!-- /container -->
	<script type="text/javascript" th:src="@{/jquery/jquery-2.1.1.min.js}"
		src="jquery/jquery-2.1.1.min.js"></script>
	<script type="text/javascript"
		th:src="@{/bootstrap/js/bootstrap.min.js}"
		src="bootstrap/js/bootstrap.min.js"></script>
	<script type="text/javascript" th:src="@{/script/docs.min.js}"
		src="script/docs.min.js"></script>
	<script type="text/javascript" th:src="@{/script/back-to-top.js}"
		src="script/back-to-top.js"></script>
	<script type="text/javascript">
		$('#myTab a').click(function(e) {
			e.preventDefault()
			$(this).tab('show')
		});
		
		$(function() {
			
			// 回报信息的表单部分默认隐藏
			$(".returnFormDiv").hide();
			
			// 点击添加回报按钮切换表单部分的显示状态
			$("#addReturnBtn").click(function(){
				
				// toggle()把显示的元素隐藏，把隐藏的元素显示
				$(".returnFormDiv").toggle();
			});
		});
		
		// 声明一个全局的returnObj对象用于存储整个表单的数据（包括上传到OSS的图片访问路径）
		var returnObj = {};
		
		// 点击上传图片按钮打开文件选择框
		$("#uploadBtn").click(function(){
			$("[name=returnPicture]").click();
		});

		// 在文件上传框的值改变事件响应函数中预览并上传图片
		$("[name=returnPicture]").change(function(event){
			
			var file = event.target.files[0];
			
			var url = window.url || window.webkitURL;
			
			var path = url.createObjectURL(file);
			
			$(this).next().next().next().next().attr("src",path).show();
			
			// 将上传的文件封装到FormData对象中
			var formData = new FormData();
			
			formData.append("returnPicture", file);
			
			// 发送Ajax请求上传文件
			$.ajax({
				"url":"[[@{/project/create/upload/return/picture.json}]]",
				"type":"post",
				"data":formData,
				"contentType":false,
				"processData":false,
				"dataType":"json",
				"success":function(response){
					
					var result = response.result;
					
					if(result == "SUCCESS") {
						alert("SUCCESS!");
						
						// 如果上传成功，则从响应体数据中获取图片的访问路径
						returnObj.describPicPath = response.data;
					}
					
					if(result == "FAILED") {
						alert(response.message);
					}
					
				},
				"error":function(response){
					alert(response.status + " " + response.statusText);
				}
			});
			
		});
		
		// 声明序号保存表格中数据的序号
		var order = 0;

		// 点击确定按钮，绑定单击响应函数
		$("#okBtn").click(function(){
			
			// 1.收集表单数据
			returnObj.type = $("[name=type]:checked").val();
			returnObj.supportmoney = $("[name=supportmoney]").val();
			returnObj.content = $("[name=content]").val();
			returnObj.count = $("[name=count]").val();
			returnObj.signalpurchase = $("[name=signalpurchase]:checked").val();
			returnObj.purchase = $("[name=purchase]").val();
			returnObj.freight = $("[name=freight]").val();
			returnObj.invoice = $("[name=invoice]:checked").val();
			returnObj.returndate = $("[name=returndate]").val();
			
			// 2.发送Ajax请求
			$.ajax({
				"url" : "[[@{/project/create/save/return.json}]]",
				"type": "post",
				"dataType": "json",
				"data": returnObj,
				"success": function(response) {
					var result = response.result;
					if(result == "SUCCESS") {
						alert("这一条保存成功！");
						
						// 使用returnObj填充表格
						var orderTd = "<td>"+(++order)+"</td>";
						var supportmoneyTd = "<td>"+returnObj.supportmoney+"</td>";
						var countTd = "<td>"+returnObj.count+"</td>";
						var signalpurchaseTd = "<td>"+(returnObj.signalpurchase == 0?"No limit":("Limit"+returnObj.purchase))+"</td>";
						var contentTd = "<td>"+returnObj.content+"</td>";
						var returndateTd = "<td>"+returnObj.returndate+"days,return</td>";
						var freightTd = "<td>"+(returnObj.freight==0?"Free shiping":returnObj.freight)+"</td>";
						var operationTd = "<td><button type='button' class='btn btn-primary btn-xs'><i class=' glyphicon glyphicon-pencil'></i></button>&nbsp;<button type='button' class='btn btn-danger btn-xs'><i class=' glyphicon glyphicon-remove'></i></button></td>";
						var trHTML = "<tr>" + orderTd + supportmoneyTd + countTd + signalpurchaseTd + contentTd + returndateTd + freightTd + operationTd + "</tr>";
						
						$("#returnTableBody").append(trHTML);
						
						$("#returnPictureImage").hide();
					}
					
					if(result == "FAILED") {
						alert("这一条保存失败！");
					}
					
					// 后续操作
					// 仅仅调用click()函数而不传入回调函数表示点击一下这个按钮
					$("#resetBtn").click();
					
					// 将表单部分div隐藏
					$(".returnFormDiv").hide();
				}
			});
		});
	</script>
</body>
</html>